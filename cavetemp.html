<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Primary Meta Tags -->
    <title>Maison Edgar d'Esplot - Négociant en Vins de Bourgogne</title>
    <meta name="title" content="Maison Edgar d'Esplot - Négociant en Vins de Bourgogne" />
    <meta name="description"
        content="Depuis 1973, notre passion pour les grands vins de Bourgogne se transmet de génération en génération. En tant que NEGOCIANTS, nous sélectionnons avec exigence les meilleurs crus pour vous offrir l'excellence et l'authenticité des terroirs bourguignons." />
    <meta property="og:image" content="https://edgardesplot.com/metalogo.jpg" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://edgardesplot.com/" />
    <meta property="og:title" content="Maison Edgar d'Esplot - Négociant en Vins de Bourgogne" />
    <meta property="og:description"
        content="Depuis 1973, notre passion pour les grands vins de Bourgogne se transmet de génération en génération. En tant que NEGOCIANTS, nous sélectionnons avec exigence les meilleurs crus pour vous offrir l'excellence et l'authenticité des terroirs bourguignons." />
    <meta property="og:image" content="https://edgardesplot.com/metalogo.jpg" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://edgardesplot.com/" />
    <meta property="twitter:title" content="Maison Edgar d'Esplot - Négociant en Vins de Bourgogne" />
    <meta property="twitter:description"
        content="Depuis 1973, notre passion pour les grands vins de Bourgogne se transmet de génération en génération. En tant que NEGOCIANTS, nous sélectionnons avec exigence les meilleurs crus pour vous offrir l'excellence et l'authenticité des terroirs bourguignons." />
    <meta property="twitter:image" content="https://edgardesplot.com/metalogo.jpg" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <style>
        body {
            font-family: 'Garamond', serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background-color: #f5f1e6;
            color: #4a2c2a;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a0a0d;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease-out;
        }
        
        .loading-text {
            color: #fff;
            font-family: 'Garamond', serif;
            font-style: italic;
            margin-top: 20px;
            font-size: 1.5rem;
        }
        
        /* Header & Navigation */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 15px 0;
            transition: all 0.4s ease;
            background-color: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
        }

        header.scrolled {
            padding: 10px 0;
        }

        .header-content {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-img {
            height: 140px;
            transition: all 0.4s ease;
        }

        header.scrolled .logo-img {
            height: 70px;
        }

        /* Hero Section */
        .hero {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        .hero video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .hero-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            width: 80%;
        }
        
        .hero-content .tagline {
            font-size: 36px;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .hero-content h2 {
            font-size: 48px;
            color: white;
        }
        
        /* Wine Gallery */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .wine-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin-top: 30px;
        }
        
        .wine-card {
            width: 30%;
            margin-bottom: 30px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .wine-card:hover {
            transform: scale(1.05);
        }
        
        .wine-image {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        /* Wine Description */
        .wine-description {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .wine-description.active {
            display: flex;
            opacity: 1;
        }
        
        .wine-description-inner {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            max-width: 80%;
            max-height: 80%;
            position: relative;
            margin: auto;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .wine-description.active .wine-description-inner {
            transform: scale(1);
        }
        
        .wine-description-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .wine-description-image {
            max-width: 100%;
            max-height: 400px;
            margin-bottom: 20px;
            border-radius: 4px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 24px;
            color: #731c19;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            background-color: #f5f1e6;
        }
        
        h1, h2 {
            color: #731c19;
        }
        
        h3 {
            color: #731c19;
            margin: 0 0 15px 0;
            font-size: 22px;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .wine-card {
                width: 45%;
            }
            .hero-content .tagline {
                font-size: 28px;
            }
            .hero-content h2 {
                font-size: 36px;
            }
        }

        @media (max-width: 480px) {
            .wine-card {
                width: 100%;
            }
            .hero-content .tagline {
                font-size: 22px;
            }
            .hero-content h2 {
                font-size: 30px;
            }
        }
                /* Chat Widget - MINEO Dark Theme */
                .chat-widget {
            position: fixed;
            bottom: 20px;
            left: 20px;
            /* Positioned at bottom left */
            z-index: 1000;
            font-family: 'Inter', sans-serif;
            display: block;
            /* Always visible */
        }

        .chat-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: brown;
            /* Using MINEO's accent blue */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(41, 121, 255, 0.4);
            transition: all 0.3s ease;
            border: 1px solid rgba(41, 121, 255, 0.3);
        }

        .chat-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(41, 121, 255, 0.5);
        }

        .chat-container {
            position: absolute;
            bottom: 80px;
            left: 0;
            /* Aligned with the chat button */
            width: 350px;
            height: 500px;
            background: rgba(30, 38, 50, 0.95);
            /* Darker, more opaque background */
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom left;
            transform: scale(0);
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(41, 121, 255, 0.2);
        }

        .chat-container.active {
            transform: scale(1);
            opacity: 1;
        }

        .chat-header {
            padding: 15px 20px;
            background: linear-gradient(90deg, #2979ff, #1565c0);
            /* Gradient header */
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 85%;
            line-height: 1.5;
            font-size: 14px;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            background: #2979ff;
            /* MINEO accent blue */
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .bot-message {
            background: rgba(255, 255, 255, 0.08);
            /* Slightly lighter than background */
            color: #ffffff;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(41, 121, 255, 0.2);
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid rgba(41, 121, 255, 0.2);
            background: rgba(20, 28, 40, 0.95);
            /* Slightly darker than chat container */
        }

        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid rgba(41, 121, 255, 0.3);
            border-radius: 30px;
            font-size: 14px;
            background: rgba(30, 38, 50, 0.7);
            color: #ffffff;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #2979ff;
            box-shadow: 0 0 0 2px rgba(41, 121, 255, 0.2);
        }

        .chat-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-input button {
            background: #2979ff;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: #75a7ff;
            transform: translateY(-2px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 15px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: rgba(41, 121, 255, 0.7);
            border-radius: 50%;
            display: inline-block;
            margin: 0 1px;
            opacity: 0.8;
        }

        .typing-indicator span:nth-child(1) {
            animation: typing 1s infinite 0s;
        }

        .typing-indicator span:nth-child(2) {
            animation: typing 1s infinite 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation: typing 1s infinite 0.4s;
        }

        @keyframes typing {
            0% {
                transform: translateY(0);
                opacity: 0.8;
            }

            50% {
                transform: translateY(-5px);
                opacity: 1;
            }

            100% {
                transform: translateY(0);
                opacity: 0.8;
            }
        }

        /* Custom scrollbar for chat messages */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(41, 121, 255, 0.5);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(41, 121, 255, 0.7);
        }


        /* Add to your existing CSS */
        .bot-message p {
            margin: 0 0 10px 0;
        }

        .bot-message p:last-child {
            margin-bottom: 0;
        }

        .bot-message a {
            color: #75a7ff;
            text-decoration: underline;
        }

        .bot-message a:hover {
            color: #2979ff;
        }

        .bot-message ul,
        .bot-message ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .bot-message li {
            margin-bottom: 5px;
        }

        /* Add this to your existing CSS */

        .preorder-link {
            display: inline-block;
            color: white !important;
            background: linear-gradient(90deg, #2979ff, #1565c0);
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px 0;
            font-weight: 500;
            text-decoration: none !important;
            box-shadow: 0 2px 8px rgba(41, 121, 255, 0.4);
            transition: all 0.3s ease;
        }

        .preorder-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 121, 255, 0.6);
            background: linear-gradient(90deg, #1565c0, #0d47a1);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <dotlottie-player src="https://lottie.host/c4004572-029e-470f-98e7-64f3ba1d443c/PNMNsGU9ZV.lottie" background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay></dotlottie-player>
        <p class="loading-text">Le nectar s'apprête à être servi...</p>
    </div>

    <!-- Header -->
    <header id="header">
        <div class="header-content">
            <div class="logo-container">
                <img src="LOGOROUGE.png" alt="Logo" class="logo-img">
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="hero">
        <video autoplay muted loop>
            <source src="6356806-sd_640_360_30fps.mp4" type="video/mp4">
            Votre navigateur ne prend pas en charge la lecture vidéo.
        </video>
        <div class="hero-content">
            <div class="tagline">
                "Notre cave, sanctuaire des grands terroirs bourguignons"
            </div>
            <h2>Notre Sélection</h2>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="wine-gallery">
            <div class="wine-card" onclick="showDescription('pommard')">
                <img src="ETA057419_HP POMMARD EN MAREAU 2023_MEB ME.png" alt="Pommard 2023" class="wine-image">
            </div>
            <div class="wine-card" onclick="showDescription('chablis')">
                <img src="ETA057419V_HP CHOREY LES BEAUNE 2021_MEB ME.png" alt="Chablis 2023" class="wine-image">
            </div>
            <div class="wine-card" onclick="showDescription('saint-romain')">
                <img src="ETA057419_HP VOSNE ROMANEE 2022_MEB DD.png" alt="Saint-Romain 2023" class="wine-image">
            </div>
        </div>

        <!-- Wine Descriptions -->
        <div id="pommard-description" class="wine-description">
            <div class="wine-description-inner">
                <span class="close-btn" onclick="closeDescription('pommard')">×</span>
                <div class="wine-description-content">
                    <img src="ETA057419_HP POMMARD EN MAREAU 2023_MEB ME.png" alt="Pommard 2023" class="wine-description-image">
                    <h3>Pommard Premier Cru 2023</h3>
                    <p>Un vin d'une structure remarquable, alliant puissance et élégance. Les tanins soyeux soutiennent des arômes de fruits noirs et d'épices, révélant toute la noblesse de ce terroir d'exception.</p>
                </div>
            </div>
        </div>

        <div id="chablis-description" class="wine-description">
            <div class="wine-description-inner">
                <span class="close-btn" onclick="closeDescription('chablis')">×</span>
                <div class="wine-description-content">
                    <img src="ETA057419V_HP CHOREY LES BEAUNE 2021_MEB ME.png" alt="Chablis 2023" class="wine-description-image">
                    <h3>Chablis Grand Cru 2023</h3>
                    <p>La minéralité caractéristique du terroir de Chablis s'exprime pleinement dans ce millésime d'une précision remarquable. Notes d'agrumes et tension vibrante composent un ensemble d'une grande pureté.</p>
                </div>
            </div>
        </div>

        <div id="saint-romain-description" class="wine-description">
            <div class="wine-description-inner">
                <span class="close-btn" onclick="closeDescription('saint-romain')">×</span>
                <div class="wine-description-content">
                    <img src="ETA057419_HP VOSNE ROMANEE 2022_MEB DD.png" alt="Saint-Romain 2023" class="wine-description-image">
                    <h3>Saint-Romain 2023</h3>
                    <p>La révélation de l'année! Ce blanc d'une finesse aromatique surprenante offre un équilibre parfait entre fraîcheur citronnée et notes beurrées subtiles.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fonction pour masquer l'écran de chargement
        window.addEventListener('load', function() {
            // Attendre que tout soit chargé, puis un délai supplémentaire pour montrer l'animation
            setTimeout(function() {
                const loadingScreen = document.querySelector('.loading-screen');
                loadingScreen.style.opacity = '0';
                
                // Attendre la fin de l'animation de fondu avant de cacher complètement
                setTimeout(function() {
                    loadingScreen.style.display = 'none';
                }, 800);
            }, 2500); // Délai minimum pour que l'animation soit visible
        });
        
        // Pour gérer l'effet de scroll sur le header
        window.addEventListener('scroll', function() {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });
        
        // Afficher la description du vin avec image
        function showDescription(wine) {
            const descElement = document.getElementById(wine + '-description');
            descElement.classList.add('active');
            
            // Empêcher le défilement du contenu en arrière-plan
            document.body.style.overflow = 'hidden';
            
            // Fermer en cliquant en dehors du contenu
            descElement.addEventListener('click', function(e) {
                if (e.target === descElement) {
                    closeDescription(wine);
                }
            });
        }

        function closeDescription(wine) {
            const descElement = document.getElementById(wine + '-description');
            descElement.classList.remove('active');
            
            // Restaurer le défilement
            document.body.style.overflow = 'auto';
        }
    </script>
        </script>
        <!-- Chat Widget -->
        <div class="chat-widget">
            <div class="chat-button" id="chat-button">
                <i class="fas fa-comment"></i>
            </div>
            <div class="chat-container" id="chat-container">
                <div class="chat-header">
                    <h3>Gary</h3>
                    <button class="close-chat" id="close-chat"><i class="fas fa-times"></i></button>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot-message">
                        👋Salut ! Gary à votre service, patron de la Maison Edgar d'Esplot depuis 2022 !

Alors, amateur de bons vins ou juste curieux ? J'ai des pépites de Bourgogne qui vont vous faire sourire ! Un petit Pommard ? Un Chablis qui décoiffe ?

Tenez, goûtez-moi ça... 🍷

On a des offres spéciales salon aujourd'hui, et je peux vous faire un prix sympa par caisse. Des questions sur nos vins ? Je suis là pour ça ! Qu'est-ce qui vous ferait plaisir ?
                    </div>
    
                </div>
                <div class="chat-input">
                    <input type="text" id="user-input" placeholder="Ask Gary about Wines...">
                    <button id="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    
        <script>
            // Chat functionality
            document.addEventListener('DOMContentLoaded', function () {
                const chatButton = document.getElementById('chat-button');
                const chatContainer = document.getElementById('chat-container');
                const closeChat = document.getElementById('close-chat');
                const sendButton = document.getElementById('send-button');
                const userInput = document.getElementById('user-input');
                const chatMessages = document.getElementById('chat-messages');
    
                // Store conversation history
                let conversationHistory = [];
    
                // Open chat window when button is clicked
                chatButton.addEventListener('click', () => {
                    chatContainer.classList.add('active');
                });
    
                // Close chat window
                closeChat.addEventListener('click', () => {
                    chatContainer.classList.remove('active');
                });
    
                // Send message function
                async function sendMessage() {
                    const message = userInput.value.trim();
                    if (!message) return;
    
                    // Add user message to chat
                    addMessage('user', message, false);
                    userInput.value = '';
    
                    // Add to conversation history
                    conversationHistory.push({
                        role: 'user',
                        content: message
                    });
    
                    // Show typing indicator
                    showTypingIndicator();
    
                    try {
                        // Call your Vercel API route
                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: message,
                                history: conversationHistory
                            })
                        });
    
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }
    
                        const data = await response.json();
    
                        // Add to conversation history
                        conversationHistory.push({
                            role: 'assistant',
                            content: data.response
                        });
    
                        // Remove typing indicator and display response
                        removeTypingIndicator();
                        addMessage('bot', data.response, true);
    
                    } catch (error) {
                        console.error('Error:', error);
                        removeTypingIndicator();
                        addMessage('bot', 'I apologize, but I encountered an error. Please try again.', false);
                    }
                }
    
                // Add message to chat
                function addMessage(sender, text, withTypingEffect = false) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${sender}-message`;
    
                    if (withTypingEffect) {
                        // Format the text with proper paragraphs and links
                        const formattedText = formatMessageText(text);
    
                        // Add empty paragraph to start with
                        messageDiv.innerHTML = '';
                        chatMessages.appendChild(messageDiv);
    
                        // Apply typing effect
                        typeMessage(messageDiv, formattedText, 0, 10);
                    } else {
                        // For user messages or error messages, display immediately
                        messageDiv.textContent = text;
                        chatMessages.appendChild(messageDiv);
                    }
    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
    
                // Format message text for better readability and make links clickable
                function formatMessageText(text) {
                    // First, escape any HTML (security measure)
                    text = escapeHtml(text);
    
                    // Replace URLs with clickable links but exclude trailing punctuation
                    text = text.replace(
                        /(https?:\/\/[^\s]+?)([.,;:!?])?(\s|$)/g,
                        function (match, url, punctuation, trailing) {
                            return '<a href="' + url + '" target="_blank" rel="noopener noreferrer">' + url + '</a>' + (punctuation || '') + trailing;
                        }
                    );
    
                    // Specific handling for the cave link to make it more visible
                    text = text.replace(
                        /<a href="https:\/\/edgardesplot\.com\/cave\.html"([^>]+)>https:\/\/edgardesplot\.com\/cave\.html<\/a>/g,
                        '<a href="https://edgardesplot.com/cave.html"$1 class="Nos Vins">Nos Vins</a>'
                    );
    
                    // Replace line breaks with <br> tags
                    text = text.replace(/\n/g, '<br>');
    
                    // Add paragraph breaks for better readability
                    text = text.replace(/<br><br>/g, '</p><p>');
    
                    // Wrap in paragraph tags if not already
                    if (!text.startsWith('<p>')) {
                        text = '<p>' + text;
                    }
                    if (!text.endsWith('</p>')) {
                        text = text + '</p>';
                    }
    
                    return text;
                }
    
    
                // Helper function to escape HTML
                function escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }
    
                // Typing effect function
                function typeMessage(element, text, index, speed) {
                    if (index < text.length) {
                        element.innerHTML = text.substring(0, index + 1);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
    
                        // Handle HTML tags so they don't disrupt the typing effect
                        if (text.charAt(index) === '<') {
                            // Find the closing bracket of the tag
                            const closeIndex = text.indexOf('>', index);
                            if (closeIndex !== -1) {
                                // Skip to after the tag
                                index = closeIndex;
                            }
                        }
    
                        setTimeout(function () {
                            typeMessage(element, text, index + 1, speed);
                        }, speed);
                    }
                }
    
                // Show typing indicator
                function showTypingIndicator() {
                    const indicatorDiv = document.createElement('div');
                    indicatorDiv.className = 'typing-indicator';
                    indicatorDiv.innerHTML = '<span></span><span></span><span></span>';
                    indicatorDiv.id = 'typing-indicator';
                    chatMessages.appendChild(indicatorDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
    
                // Remove typing indicator
                function removeTypingIndicator() {
                    const indicator = document.getElementById('typing-indicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }
    
                // Event listeners
                sendButton.addEventListener('click', sendMessage);
    
                userInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            });
        </script>        
</body>
</html>
